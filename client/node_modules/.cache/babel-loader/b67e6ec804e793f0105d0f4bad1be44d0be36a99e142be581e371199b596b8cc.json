{"ast":null,"code":"class SocketService {\n  static getInstance() {\n    if (!SocketService.instance) {\n      SocketService.instance = new SocketService();\n    }\n    return SocketService.instance;\n  }\n  constructor() {\n    this.socket = null;\n    this.callbacks = {};\n    this.retryCount = 0;\n    const hostname = window.location.hostname;\n    this.wsUrl = `ws://${hostname}:8080`; // WebSocket dinámico\n    this.baseUrl = `http://${hostname}:3001`; // REST API dinámico\n  }\n  connect(callback) {\n    try {\n      this.socket = new WebSocket(this.wsUrl);\n      this.socket.onopen = () => {\n        console.log('✅ WebSocket conectado a', this.wsUrl);\n        this.retryCount = 0;\n        if (callback) callback();\n      };\n      this.socket.onmessage = msg => {\n        try {\n          const data = JSON.parse(msg.data);\n          if (this.callbacks[data.type]) {\n            this.callbacks[data.type](data);\n          }\n        } catch (error) {\n          console.error('❌ Error procesando mensaje:', error);\n        }\n      };\n      this.socket.onclose = () => {\n        console.warn('🔌 WebSocket desconectado');\n        this.scheduleReconnect();\n      };\n      this.socket.onerror = error => {\n        console.error('⚠️ Error WebSocket:', error);\n      };\n    } catch (error) {\n      console.error('❌ Error al conectar WebSocket:', error);\n      this.scheduleReconnect();\n    }\n  }\n  scheduleReconnect() {\n    const delay = Math.min(1000 * 2 ** this.retryCount, 30000);\n    this.retryCount += 1;\n    setTimeout(() => this.connect(), delay);\n  }\n  on(event, callback) {\n    this.callbacks[event] = callback;\n  }\n  send(data) {\n    var _this$socket;\n    if (((_this$socket = this.socket) === null || _this$socket === void 0 ? void 0 : _this$socket.readyState) === WebSocket.OPEN) {\n      this.socket.send(JSON.stringify(data));\n    } else {\n      console.error('🚫 WebSocket no está conectado');\n    }\n  }\n  async waitForSocketReady(retries = 5) {\n    return new Promise((resolve, reject) => {\n      const check = () => {\n        var _this$socket2;\n        if (((_this$socket2 = this.socket) === null || _this$socket2 === void 0 ? void 0 : _this$socket2.readyState) === WebSocket.OPEN) {\n          resolve();\n        } else if (retries > 0) {\n          setTimeout(() => check(--retries), 500);\n        } else {\n          reject('WebSocket no disponible');\n        }\n      };\n      check();\n    });\n  }\n\n  // Métodos REST\n  async fetchMenu() {\n    const response = await fetch(`${this.baseUrl}/dishes`);\n    return await response.json();\n  }\n  async fetchAlcohol() {\n    const response = await fetch(`${this.baseUrl}/alcohol`);\n    return await response.json();\n  }\n  async createOrder(order) {\n    const response = await fetch(`${this.baseUrl}/orders`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(order)\n    });\n    return await response.json();\n  }\n  async completeOrder(orderId) {\n    const response = await fetch(`${this.baseUrl}/orders/${orderId}`, {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        status: 'completed'\n      })\n    });\n    return await response.json();\n  }\n}\n\n// Instancia Singleton\nSocketService.instance = null;\nexport const socket = SocketService.getInstance();\n\n// Inicializa conexión WebSocket\nexport const initializeSocketConnection = onOrderUpdate => {\n  socket.on('initial_data', data => {\n    if (onOrderUpdate) onOrderUpdate(data);\n  });\n  socket.on('update', data => {\n    if (onOrderUpdate) onOrderUpdate(data);\n  });\n  socket.connect();\n};\n\n// Funciones para usar en Bar y Bartender\nexport const fetchMenuItems = () => socket.fetchMenu();\nexport const fetchAlcoholItems = () => socket.fetchAlcohol();\nexport const placeNewOrder = async order => {\n  try {\n    await socket.createOrder(order);\n    await socket.waitForSocketReady(); // 🔁 Esperar que el socket esté conectado\n    socket.send({\n      type: 'new_order',\n      order\n    });\n    console.log('📦 Pedido enviado vía WebSocket:', order);\n  } catch (err) {\n    console.error('❌ No se pudo enviar pedido por WebSocket:', err);\n  }\n};\nexport const markOrderAsCompleted = async orderId => {\n  try {\n    await socket.completeOrder(orderId);\n    await socket.waitForSocketReady(); // 🔁 Esperar socket antes de enviar\n    socket.send({\n      type: 'complete_order',\n      orderId\n    });\n  } catch (err) {\n    console.error('❌ No se pudo enviar confirmación de completado:', err);\n  }\n};","map":{"version":3,"names":["SocketService","getInstance","instance","constructor","socket","callbacks","retryCount","hostname","window","location","wsUrl","baseUrl","connect","callback","WebSocket","onopen","console","log","onmessage","msg","data","JSON","parse","type","error","onclose","warn","scheduleReconnect","onerror","delay","Math","min","setTimeout","on","event","send","_this$socket","readyState","OPEN","stringify","waitForSocketReady","retries","Promise","resolve","reject","check","_this$socket2","fetchMenu","response","fetch","json","fetchAlcohol","createOrder","order","method","headers","body","completeOrder","orderId","status","initializeSocketConnection","onOrderUpdate","fetchMenuItems","fetchAlcoholItems","placeNewOrder","err","markOrderAsCompleted"],"sources":["C:/Users/karen/OneDrive/Escritorio/Correa3/Correa/client/src/services/socket.js"],"sourcesContent":["class SocketService {\r\n  static instance = null;\r\n\r\n  static getInstance() {\r\n    if (!SocketService.instance) {\r\n      SocketService.instance = new SocketService();\r\n    }\r\n    return SocketService.instance;\r\n  }\r\n\r\n  constructor() {\r\n    this.socket = null;\r\n    this.callbacks = {};\r\n    this.retryCount = 0;\r\n\r\n    const hostname = window.location.hostname;\r\n    this.wsUrl = `ws://${hostname}:8080`; // WebSocket dinámico\r\n    this.baseUrl = `http://${hostname}:3001`; // REST API dinámico\r\n  }\r\n\r\n  connect(callback) {\r\n    try {\r\n      this.socket = new WebSocket(this.wsUrl);\r\n\r\n      this.socket.onopen = () => {\r\n        console.log('✅ WebSocket conectado a', this.wsUrl);\r\n        this.retryCount = 0;\r\n        if (callback) callback();\r\n      };\r\n\r\n      this.socket.onmessage = (msg) => {\r\n        try {\r\n          const data = JSON.parse(msg.data);\r\n          if (this.callbacks[data.type]) {\r\n            this.callbacks[data.type](data);\r\n          }\r\n        } catch (error) {\r\n          console.error('❌ Error procesando mensaje:', error);\r\n        }\r\n      };\r\n\r\n      this.socket.onclose = () => {\r\n        console.warn('🔌 WebSocket desconectado');\r\n        this.scheduleReconnect();\r\n      };\r\n\r\n      this.socket.onerror = (error) => {\r\n        console.error('⚠️ Error WebSocket:', error);\r\n      };\r\n\r\n    } catch (error) {\r\n      console.error('❌ Error al conectar WebSocket:', error);\r\n      this.scheduleReconnect();\r\n    }\r\n  }\r\n\r\n  scheduleReconnect() {\r\n    const delay = Math.min(1000 * (2 ** this.retryCount), 30000);\r\n    this.retryCount += 1;\r\n    setTimeout(() => this.connect(), delay);\r\n  }\r\n\r\n  on(event, callback) {\r\n    this.callbacks[event] = callback;\r\n  }\r\n\r\n  send(data) {\r\n    if (this.socket?.readyState === WebSocket.OPEN) {\r\n      this.socket.send(JSON.stringify(data));\r\n    } else {\r\n      console.error('🚫 WebSocket no está conectado');\r\n    }\r\n  }\r\n\r\n  async waitForSocketReady(retries = 5) {\r\n    return new Promise((resolve, reject) => {\r\n      const check = () => {\r\n        if (this.socket?.readyState === WebSocket.OPEN) {\r\n          resolve();\r\n        } else if (retries > 0) {\r\n          setTimeout(() => check(--retries), 500);\r\n        } else {\r\n          reject('WebSocket no disponible');\r\n        }\r\n      };\r\n      check();\r\n    });\r\n  }\r\n\r\n  // Métodos REST\r\n  async fetchMenu() {\r\n    const response = await fetch(`${this.baseUrl}/dishes`);\r\n    return await response.json();\r\n  }\r\n\r\n  async fetchAlcohol() {\r\n    const response = await fetch(`${this.baseUrl}/alcohol`);\r\n    return await response.json();\r\n  }\r\n\r\n  async createOrder(order) {\r\n    const response = await fetch(`${this.baseUrl}/orders`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(order)\r\n    });\r\n    return await response.json();\r\n  }\r\n\r\n  async completeOrder(orderId) {\r\n    const response = await fetch(`${this.baseUrl}/orders/${orderId}`, {\r\n      method: 'PATCH',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ status: 'completed' })\r\n    });\r\n    return await response.json();\r\n  }\r\n}\r\n\r\n// Instancia Singleton\r\nexport const socket = SocketService.getInstance();\r\n\r\n// Inicializa conexión WebSocket\r\nexport const initializeSocketConnection = (onOrderUpdate) => {\r\n  socket.on('initial_data', (data) => {\r\n    if (onOrderUpdate) onOrderUpdate(data);\r\n  });\r\n  socket.on('update', (data) => {\r\n    if (onOrderUpdate) onOrderUpdate(data);\r\n  });\r\n  socket.connect();\r\n};\r\n\r\n// Funciones para usar en Bar y Bartender\r\nexport const fetchMenuItems = () => socket.fetchMenu();\r\nexport const fetchAlcoholItems = () => socket.fetchAlcohol();\r\n\r\nexport const placeNewOrder = async (order) => {\r\n  try {\r\n    await socket.createOrder(order);\r\n    await socket.waitForSocketReady(); // 🔁 Esperar que el socket esté conectado\r\n    socket.send({ type: 'new_order', order });\r\n    console.log('📦 Pedido enviado vía WebSocket:', order);\r\n  } catch (err) {\r\n    console.error('❌ No se pudo enviar pedido por WebSocket:', err);\r\n  }\r\n};\r\n\r\nexport const markOrderAsCompleted = async (orderId) => {\r\n  try {\r\n    await socket.completeOrder(orderId);\r\n    await socket.waitForSocketReady(); // 🔁 Esperar socket antes de enviar\r\n    socket.send({ type: 'complete_order', orderId });\r\n  } catch (err) {\r\n    console.error('❌ No se pudo enviar confirmación de completado:', err);\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}